<?php
$servername = "localhost";
$username = "root";
$password = "";
$dbName = "barbershop";

// Create connection
$conn = mysqli_connect($servername, $username, $password, $dbName);

// Check connection
if (mysqli_connect_errno()) {
    echo "Failed";
}

$currentDate = date('Y-m-d');

// Retrieve form data
$name = $_POST['name'];
$email = $_POST['email'];
$number = $_POST['number'];
$date = $_POST['date'];
$time = $_POST['time'];

// Check if there is an existing record with the same date and time
$existingRecordQuery = "SELECT * FROM appointments WHERE date = '$date' AND time = '$time'";
$result = mysqli_query($conn, $existingRecordQuery);

if (mysqli_num_rows($result) > 0) {
    // Record with the same date and time already exists
    echo '<script>alert("Appointment already exists for the selected date and time. Please choose a different date or time.");</script>';
    echo '<script>window.location.href = "appointment.html";</script>';
} elseif ($date < $currentDate) {
    // Date is in the past
    echo '<script>alert("Enter a Valid Date");</script>';
    echo '<script>window.location.href = "appointment.html";</script>';
} else {
    // No conflicting record, proceed with the insertion
    $stmt = $conn->prepare("INSERT INTO appointments (name, email, number, date, time) VALUES (?, ?, ?, ?, ?)");
    $stmt->bind_param("sssss", $name, $email, $number, $date, $time);
    $stmt->execute();
    echo "Insert success";
    $stmt->close();
    $conn->close();
}
?>
